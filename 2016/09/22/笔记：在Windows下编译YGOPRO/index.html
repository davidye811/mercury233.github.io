
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>笔记：在Windows下编译YGOPRO | Mercury233</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Mercury233">
    

    
    <meta name="description" content="近期在 mycard 项目中尝试了自动化编译 YGOPRO，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。本笔记基本上是参考了 DailyShana 的 build 分支写成，感谢 soarqin 和 DailyShana 的工作。本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适">
<meta property="og:type" content="article">
<meta property="og:title" content="笔记：在Windows下编译YGOPRO">
<meta property="og:url" content="http://mercury233.me/2016/09/22/笔记：在Windows下编译YGOPRO/index.html">
<meta property="og:site_name" content="Mercury233">
<meta property="og:description" content="近期在 mycard 项目中尝试了自动化编译 YGOPRO，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。本笔记基本上是参考了 DailyShana 的 build 分支写成，感谢 soarqin 和 DailyShana 的工作。本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适">
<meta property="og:updated_time" content="2016-09-22T14:19:09.044Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="笔记：在Windows下编译YGOPRO">
<meta name="twitter:description" content="近期在 mycard 项目中尝试了自动化编译 YGOPRO，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。本笔记基本上是参考了 DailyShana 的 build 分支写成，感谢 soarqin 和 DailyShana 的工作。本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适">

    
    
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Mercury233">Mercury233</a></h1>
				<h2 class="blog-motto">随便写写</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/categories/%E4%BD%9C%E5%93%81/">Works</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:mercury233.me">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/09/22/笔记：在Windows下编译YGOPRO/" title="笔记：在Windows下编译YGOPRO" itemprop="url">笔记：在Windows下编译YGOPRO</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mercury233" target="_blank" itemprop="author">Mercury233</a>
		
  <p class="article-time">
    <time datetime="2016-09-22T14:10:00.000Z" itemprop="datePublished"> 发表于 2016-09-22</time>
    
  </p>
</header>
	<div class="article-content">
		
		<p>近期在 mycard 项目中尝试了自动化编译 <a href="https://github.com/Fluorohydride/ygopro" target="_blank" rel="external">YGOPRO</a>，发现官方采用 premake 生成项目文件，但并没有给出具体方法。故在此记录下折腾的成果。<br>本笔记基本上是参考了 <a href="https://github.com/DailyShana/ygopro/tree/build" target="_blank" rel="external">DailyShana 的 build 分支</a>写成，感谢 soarqin 和 DailyShana 的工作。<br>本笔记的操作在 Windows 7 和 Visual Studio Community 2015 上测试通过，理论上也可以适用于XP之后的系统。<br><a id="more"></a></p>
<h1 id="0-_准备">0. 准备</h1><p>必须下载：</p>
<ul>
<li><a href="https://premake.github.io/" target="_blank" rel="external">Premake</a><br>下载地址：<a href="https://github.com/premake/premake-core/releases/download/v5.0.0-alpha9/premake-5.0.0-alpha9-windows.zip" target="_blank" rel="external">premake-5.0.0-alpha9-windows.zip</a></li>
<li><a href="http://libevent.org/" target="_blank" rel="external">libevent</a><br>下载地址：<a href="https://github.com/libevent/libevent/releases/download/release-2.0.22-stable/libevent-2.0.22-stable.tar.gz" target="_blank" rel="external">libevent-2.0.22-stable.tar.gz</a></li>
<li><a href="https://www.freetype.org/" target="_blank" rel="external">FreeType</a><br>下载地址：<a href="http://downloads.sourceforge.net/freetype/freetype-2.7.tar.bz2" target="_blank" rel="external">freetype-2.7.tar.bz2</a></li>
<li><a href="http://irrlicht.sourceforge.net/" target="_blank" rel="external">Irrlicht</a><br>下载地址：<a href="http://downloads.sourceforge.net/irrlicht/irrlicht-1.8.4.zip" target="_blank" rel="external">irrlicht-1.8.4.zip</a></li>
<li><a href="https://www.lua.org/" target="_blank" rel="external">Lua</a><br>下载地址：<a href="https://www.lua.org/ftp/lua-5.2.4.tar.gz" target="_blank" rel="external">lua-5.2.4.tar.gz</a><br>需注意不支持Lua 5.3。</li>
<li><a href="https://www.sqlite.org/" target="_blank" rel="external">SQLite</a><br>下载地址：<a href="https://www.sqlite.org/2016/sqlite-amalgamation-3140200.zip" target="_blank" rel="external">sqlite-amalgamation-3140200.zip</a></li>
</ul>
<p>建议下载：</p>
<ul>
<li><a href="https://git-for-windows.github.io/" target="_blank" rel="external">Git for Windows</a><br>用于自动获取和更新 YGOPRO 的源码。此外其包含了 MSYS2，提供后文需要用到的 patch 工具。<br>如果不使用 git，你将需要手动下载 YGOPRO 的子模块。此外，在上游和你都对源码做出修改后，你需要手动合并代码。<br><strong>本文默认你已经安装了 Git for Windows，并且设置了账号和 GitHub 的 ssh 公钥。</strong></li>
<li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=6812" target="_blank" rel="external">DirectX SDK</a><br>让 YGOPRO 支持 Direct3D 模式的必备组件。<br>如果不安装 DirectX SDK，你将需要更改 Irrlicht 的配置文件，并且编译出的 YGOPRO 将只能支持 OpenGL 模式。</li>
<li><a href="https://www.visualstudio.com/zh-cn/products/visual-studio-community-vs.aspx" target="_blank" rel="external">Visual Studio Community 2015</a><br>免费的正版Visual Studio，功能完全满足业余开发者的需求。</li>
</ul>
<h1 id="1-_获取_YGOPRO_源码">1. 获取 YGOPRO 源码</h1><p>YGOPRO 以 GPL 协议开源，托管在 GitHub，用 <code>git clone</code> 即可获得。clone 时用 <code>--recursive</code> 来同时克隆子模块。<br><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/Fluorohydride/ygopro.git --recursive</span><br></pre></td></tr></table></figure></p>
<p>子模块的引用往往不是最新的，需要 <code>git checkout master</code>。<br><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ygopro/</span><br><span class="line"><span class="built_in">cd</span> ocgcore/</span><br><span class="line">git checkout master</span><br><span class="line"><span class="built_in">cd</span> ../script/</span><br><span class="line">git checkout master</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure></p>
<h1 id="2-_Premake_简介">2. Premake 简介</h1><p>Premake 是一个命令行工具，用脚本定义软件工程，然后根据脚本为 Visual Studio, Xcode, 或 GNU Make 等工具生成项目文件。<a href="https://github.com/premake/premake-core/wiki/What-Is-Premake" target="_blank" rel="external">1</a><br>Premake 的脚本采用 lua 语言，十分简洁易懂，参考 <code>premake4.lua</code> 和 <code>ocgcore\premake4.lua</code> 即可略知一二。<br>于是，我们要做的就是给 <code>libevent</code>、<code>FreeType</code>、<code>Irrlicht</code>、<code>Lua</code> 和 <code>SQLite</code> 写 premake 文件，并最后用 Premake 生成 Visual Studio 的项目文件（解决方案）。</p>
<h1 id="3-_配置_libevent">3. 配置 libevent</h1><p>解压 <a href="https://github.com/libevent/libevent/releases/download/release-2.0.22-stable/libevent-2.0.22-stable.tar.gz" target="_blank" rel="external"><code>libevent-2.0.22-stable.tar.gz</code></a> 到项目目录，将文件夹重命名为 <code>event</code>。<br>为兼容 YGOPRO 源码，将 <code>WIN32-Code</code> 文件夹里的文件全部移动到 <code>include</code> 文件夹。<br>根据 libevent 的 Makefile，得到如下 <a href="event/premake4.lua"><code>premake4.lua</code></a>，放到 <code>event</code> 文件夹里。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"event"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    includedirs &#123; <span class="string">"include"</span>, <span class="string">"compat"</span> &#125;</span><br><span class="line"></span><br><span class="line">    files &#123; <span class="string">"event.c"</span>, <span class="string">"evthread.c"</span>, <span class="string">"buffer.c"</span>, <span class="string">"bufferevent.c"</span>, <span class="string">"bufferevent_sock.c"</span>,</span><br><span class="line">            <span class="string">"bufferevent_filter.c"</span>, <span class="string">"bufferevent_pair.c"</span>, <span class="string">"listener.c"</span>, <span class="string">"bufferevent_ratelim.c"</span>,</span><br><span class="line">            <span class="string">"evmap.c"</span>, <span class="string">"log.c"</span>, <span class="string">"evutil.c"</span>, <span class="string">"evutil_rand.c"</span>, <span class="string">"strlcpy.c"</span>, <span class="string">"signal.c"</span>, </span><br><span class="line">            <span class="string">"event_tagging.c"</span>, <span class="string">"http.c"</span>, <span class="string">"evdns.c"</span>, <span class="string">"evrpc.c"</span> &#125;</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"windows"</span></span><br><span class="line">        files &#123; <span class="string">"win32select.c"</span>, <span class="string">"evthread_win32.c"</span>, <span class="string">"buffer_iocp.c"</span>, <span class="string">"event_iocp.c"</span>, <span class="string">"bufferevent_async.c"</span> &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="4-_配置_FreeType">4. 配置 FreeType</h1><p>解压 <a href="http://downloads.sourceforge.net/freetype/freetype-2.7.tar.bz2" target="_blank" rel="external"><code>freetype-2.7.tar.bz2</code></a> 到项目目录，将文件夹重命名为 <code>freetype</code>。<br>根据 freetype 的 vcxproj，得到如下 <a href="freetype/premake4.lua"><code>premake4.lua</code></a>，放到 <code>freetype</code> 文件夹里。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"freetype"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    includedirs &#123; <span class="string">"include"</span> &#125;</span><br><span class="line">    defines &#123; <span class="string">"FT2_BUILD_LIBRARY"</span> &#125;</span><br><span class="line"></span><br><span class="line">    files &#123; <span class="string">"src/autofit/autofit.c"</span>, <span class="string">"src/bdf/bdf.c"</span>, <span class="string">"src/cff/cff.c"</span>, <span class="string">"src/base/ftbase.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftbitmap.c"</span>, <span class="string">"src/cache/ftcache.c"</span>, <span class="string">"src/base/ftfstype.c"</span>, <span class="string">"src/base/ftgasp.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftglyph.c"</span>, <span class="string">"src/gzip/ftgzip.c"</span>, <span class="string">"src/base/ftinit.c"</span>, <span class="string">"src/lzw/ftlzw.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftstroke.c"</span>, <span class="string">"src/base/ftsystem.c"</span>, <span class="string">"src/smooth/smooth.c"</span>, <span class="string">"src/base/ftbbox.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftfntfmt.c"</span>, <span class="string">"src/base/ftmm.c"</span>, <span class="string">"src/base/ftpfr.c"</span>, <span class="string">"src/base/ftsynth.c"</span>,</span><br><span class="line">            <span class="string">"src/base/fttype1.c"</span>, <span class="string">"src/base/ftwinfnt.c"</span>, <span class="string">"src/base/ftlcdfil.c"</span>, <span class="string">"src/base/ftgxval.c"</span>,</span><br><span class="line">            <span class="string">"src/base/ftotval.c"</span>, <span class="string">"src/base/ftpatent.c"</span>, <span class="string">"src/pcf/pcf.c"</span>, <span class="string">"src/pfr/pfr.c"</span>,</span><br><span class="line">            <span class="string">"src/psaux/psaux.c"</span>, <span class="string">"src/pshinter/pshinter.c"</span>, <span class="string">"src/psnames/psmodule.c"</span>,</span><br><span class="line">            <span class="string">"src/raster/raster.c"</span>, <span class="string">"src/sfnt/sfnt.c"</span>, <span class="string">"src/truetype/truetype.c"</span>,</span><br><span class="line">            <span class="string">"src/type1/type1.c"</span>, <span class="string">"src/cid/type1cid.c"</span>, <span class="string">"src/type42/type42.c"</span>, <span class="string">"src/winfonts/winfnt.c"</span> &#125;</span><br><span class="line"></span><br><span class="line">    configuration <span class="string">"windows"</span></span><br><span class="line">        files &#123; <span class="string">"builds/windows/ftdebug.c"</span> &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="5-_配置_Irrlicht">5. 配置 Irrlicht</h1><p>解压 <a href="http://downloads.sourceforge.net/irrlicht/irrlicht-1.8.4.zip" target="_blank" rel="external"><code>irrlicht-1.8.4.zip</code></a> 到项目目录，将文件夹重命名为 <code>irrlicht</code>。<br>为使文件夹结构更加简洁，将 <code>source\Irrlicht</code> 剪切到 <code>irrlicht</code> 文件夹，重命名为 <code>src</code>。<br>Irrlicht 本身对中文显示和输入的支持存在问题，soarqin 和 DailyShana 给出了用于 Irrlicht 1.8.0 的中文支持。用在 1.8.4 只需要再修改一点点代码。<br>将以下代码保存为 <a href="irrlicht/irrlicht.patch"><code>irrlicht.patch</code></a>，在MSYS的命令行下用 <code>patch</code> 应用即可。<br><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">diff -ur --strip-trailing-cr irrlicht/include/IOSOperator.h irrlicht-fixed/include/IOSOperator.h</span><br><span class="line"><span class="header">--- irrlicht/include/IOSOperator.h	2012-11-03 10:08:34.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/include/IOSOperator.h	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -26,11 +26,11 @@</span></span><br><span class="line"> 	&#125;</span><br><span class="line"> </span><br><span class="line"> 	//! Copies text to the clipboard</span><br><span class="line"><span class="deletion">-	virtual void copyToClipboard(const c8* text) const = 0;</span></span><br><span class="line"><span class="addition">+	virtual void copyToClipboard(const c16* text) const = 0;</span></span><br><span class="line"> </span><br><span class="line"> 	//! Get text from the clipboard</span><br><span class="line"> 	/** \return Returns 0 if no string is in there. */</span><br><span class="line"><span class="deletion">-	virtual const c8* getTextFromClipboard() const = 0;</span></span><br><span class="line"><span class="addition">+	virtual const c16* getTextFromClipboard() const = 0;</span></span><br><span class="line"> </span><br><span class="line"> 	//! Get the processor speed in megahertz</span><br><span class="line"> 	/** \param MHz The integer variable to store the speed in.</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/include/irrTypes.h irrlicht-fixed/include/irrTypes.h</span><br><span class="line"><span class="header">--- irrlicht/include/irrTypes.h	2012-11-03 10:08:34.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/include/irrTypes.h	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -48,7 +48,9 @@</span></span><br><span class="line"> typedef signed short		s16;</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+//! 16 bit character variable.</span></span><br><span class="line"><span class="addition">+/** This is a typedef for wchar_t, it ensures portability of the engine. */</span></span><br><span class="line"><span class="addition">+typedef wchar_t			c16;</span></span><br><span class="line"> </span><br><span class="line"> //! 32 bit unsigned variable.</span><br><span class="line"> /** This is a typedef for unsigned int, it ensures portability of the engine. */</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/include/Keycodes.h irrlicht-fixed/include/Keycodes.h</span><br><span class="line"><span class="header">--- irrlicht/include/Keycodes.h	2012-11-03 10:08:32.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/include/Keycodes.h	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -89,7 +89,7 @@</span></span><br><span class="line"> 		KEY_KEY_X            = 0x58,  // X key</span><br><span class="line"> 		KEY_KEY_Y            = 0x59,  // Y key</span><br><span class="line"> 		KEY_KEY_Z            = 0x5A,  // Z key</span><br><span class="line"><span class="deletion">-		KEY_LWIN             = 0x5B,  // Left Windows key (Microsoft?Natural?keyboard)</span></span><br><span class="line"><span class="addition">+		KEY_LWIN             = 0x5B,  // Left Windows key (Microsoft庐 Natural庐 keyboard)</span></span><br><span class="line"> 		KEY_RWIN             = 0x5C,  // Right Windows key (Natural keyboard)</span><br><span class="line"> 		KEY_APPS             = 0x5D,  // Applications key (Natural keyboard)</span><br><span class="line"> 		KEY_SLEEP            = 0x5F,  // Computer Sleep key</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/CD3D9ShaderMaterialRenderer.cpp irrlicht-fixed/src/CD3D9ShaderMaterialRenderer.cpp</span><br><span class="line"><span class="header">--- irrlicht/src/CD3D9ShaderMaterialRenderer.cpp	2012-11-03 10:08:10.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/CD3D9ShaderMaterialRenderer.cpp	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -329,7 +329,7 @@</span></span><br><span class="line"> 			strDllName += (int)D3DX_SDK_VERSION;</span><br><span class="line"> 			strDllName += ".dll";</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-			HMODULE hMod = LoadLibrary(strDllName.c_str());</span></span><br><span class="line"><span class="addition">+			HMODULE hMod = LoadLibraryA(strDllName.c_str());</span></span><br><span class="line"> 			if (hMod)</span><br><span class="line"> 				 pFn = (AssembleShaderFunction)GetProcAddress(hMod, "D3DXAssembleShader");</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -389,7 +389,7 @@</span></span><br><span class="line"> 			strDllName += (int)D3DX_SDK_VERSION;</span><br><span class="line"> 			strDllName += ".dll";</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-			HMODULE hMod = LoadLibrary(strDllName.c_str());</span></span><br><span class="line"><span class="addition">+			HMODULE hMod = LoadLibraryA(strDllName.c_str());</span></span><br><span class="line"> 			if (hMod)</span><br><span class="line"> 				 pFn = (AssembleShaderFromFileFunction)GetProcAddress(hMod, "D3DXAssembleShaderFromFileA");</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -450,7 +450,7 @@</span></span><br><span class="line"> 			strDllName += (int)D3DX_SDK_VERSION;</span><br><span class="line"> 			strDllName += ".dll";</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-			HMODULE hMod = LoadLibrary(strDllName.c_str());</span></span><br><span class="line"><span class="addition">+			HMODULE hMod = LoadLibraryA(strDllName.c_str());</span></span><br><span class="line"> 			if (hMod)</span><br><span class="line"> 				 pFn = (D3DXCompileShaderFunction)GetProcAddress(hMod, "D3DXCompileShader");</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -510,7 +510,7 @@</span></span><br><span class="line"> 			strDllName += (int)D3DX_SDK_VERSION;</span><br><span class="line"> 			strDllName += ".dll";</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-			HMODULE hMod = LoadLibrary(strDllName.c_str());</span></span><br><span class="line"><span class="addition">+			HMODULE hMod = LoadLibraryA(strDllName.c_str());</span></span><br><span class="line"> 			if (hMod)</span><br><span class="line"> 				 pFn = (D3DXCompileShaderFromFileFunction)GetProcAddress(hMod, "D3DXCompileShaderFromFileA");</span><br><span class="line"> </span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/CGUIEditBox.cpp irrlicht-fixed/src/CGUIEditBox.cpp</span><br><span class="line"><span class="header">--- irrlicht/src/CGUIEditBox.cpp	2012-11-03 10:08:16.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/CGUIEditBox.cpp	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -286,7 +286,7 @@</span></span><br><span class="line"> 				const s32 realmbgn = MarkBegin &lt; MarkEnd ? MarkBegin : MarkEnd;</span><br><span class="line"> 				const s32 realmend = MarkBegin &lt; MarkEnd ? MarkEnd : MarkBegin;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-				core::stringc s;</span></span><br><span class="line"><span class="addition">+				core::stringw s;</span></span><br><span class="line"> 				s = Text.subString(realmbgn, realmend - realmbgn).c_str();</span><br><span class="line"> 				Operator-&gt;copyToClipboard(s.c_str());</span><br><span class="line"> 			&#125;</span><br><span class="line"><span class="chunk">@@ -299,7 +299,7 @@</span></span><br><span class="line"> 				const s32 realmend = MarkBegin &lt; MarkEnd ? MarkEnd : MarkBegin;</span><br><span class="line"> </span><br><span class="line"> 				// copy</span><br><span class="line"><span class="deletion">-				core::stringc sc;</span></span><br><span class="line"><span class="addition">+				core::stringw sc;</span></span><br><span class="line"> 				sc = Text.subString(realmbgn, realmend - realmbgn).c_str();</span><br><span class="line"> 				Operator-&gt;copyToClipboard(sc.c_str());</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -329,7 +329,7 @@</span></span><br><span class="line"> 				const s32 realmend = MarkBegin &lt; MarkEnd ? MarkEnd : MarkBegin;</span><br><span class="line"> </span><br><span class="line"> 				// add new character</span><br><span class="line"><span class="deletion">-				const c8* p = Operator-&gt;getTextFromClipboard();</span></span><br><span class="line"><span class="addition">+				const c16* p = Operator-&gt;getTextFromClipboard();</span></span><br><span class="line"> 				if (p)</span><br><span class="line"> 				&#123;</span><br><span class="line"> 					if (MarkBegin == MarkEnd)</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/CIrrDeviceWin32.cpp irrlicht-fixed/src/CIrrDeviceWin32.cpp</span><br><span class="line"><span class="header">--- irrlicht/src/CIrrDeviceWin32.cpp	2012-11-05 07:14:12.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/CIrrDeviceWin32.cpp	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -16,14 +16,16 @@</span></span><br><span class="line"> #include "COSOperator.h"</span><br><span class="line"> #include "dimension2d.h"</span><br><span class="line"> #include "IGUISpriteBank.h"</span><br><span class="line"><span class="addition">+#include "IGUIEnvironment.h"</span></span><br><span class="line"><span class="addition">+#include "IGUIElement.h"</span></span><br><span class="line"> #include &lt;winuser.h&gt;</span><br><span class="line"> #if defined(_IRR_COMPILE_WITH_JOYSTICK_EVENTS_)</span><br><span class="line"> #ifdef _IRR_COMPILE_WITH_DIRECTINPUT_JOYSTICK_</span><br><span class="line"> #define DIRECTINPUT_VERSION 0x0800</span><br><span class="line"><span class="addition">+#define INITGUID</span></span><br><span class="line"> #include &lt;dinput.h&gt;</span><br><span class="line"> #ifdef _MSC_VER</span><br><span class="line"> #pragma comment(lib, "dinput8.lib")</span><br><span class="line"><span class="deletion">-#pragma comment(lib, "dxguid.lib")</span></span><br><span class="line"> #endif</span><br><span class="line"> #else</span><br><span class="line"> #ifdef _MSC_VER</span><br><span class="line"><span class="chunk">@@ -900,8 +902,36 @@</span></span><br><span class="line"> 		KEYBOARD_INPUT_HKL = GetKeyboardLayout(0);</span><br><span class="line"> 		KEYBOARD_INPUT_CODEPAGE = LocaleIdToCodepage( LOWORD(KEYBOARD_INPUT_HKL) );</span><br><span class="line"> 		return 0;</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+	case WM_IME_STARTCOMPOSITION:</span></span><br><span class="line"><span class="addition">+		&#123;</span></span><br><span class="line"><span class="addition">+			dev = getDeviceFromHWnd(hWnd);</span></span><br><span class="line"><span class="addition">+			irr::gui::IGUIElement* ele = dev-&gt;getGUIEnvironment()-&gt;getFocus();</span></span><br><span class="line"><span class="addition">+			if(!ele)</span></span><br><span class="line"><span class="addition">+				break;</span></span><br><span class="line"><span class="addition">+			irr::core::position2di pos = ele-&gt;getAbsolutePosition().UpperLeftCorner;</span></span><br><span class="line"><span class="addition">+			HIMC hIMC = ::ImmGetContext(hWnd);</span></span><br><span class="line"><span class="addition">+			COMPOSITIONFORM CompForm;</span></span><br><span class="line"><span class="addition">+			CompForm.dwStyle = CFS_CANDIDATEPOS;</span></span><br><span class="line"><span class="addition">+			CompForm.ptCurrentPos.x = pos.X;</span></span><br><span class="line"><span class="addition">+			CompForm.ptCurrentPos.y = pos.Y + ele-&gt;getAbsolutePosition().getHeight();</span></span><br><span class="line"><span class="addition">+			::ImmSetCompositionWindow(hIMC, &amp;CompForm);</span></span><br><span class="line"><span class="addition">+			::ImmReleaseContext(hWnd, hIMC);</span></span><br><span class="line"><span class="addition">+		&#125;</span></span><br><span class="line"><span class="addition">+		break;</span></span><br><span class="line"><span class="addition">+	case WM_IME_CHAR:</span></span><br><span class="line"><span class="addition">+		event.EventType = irr::EET_KEY_INPUT_EVENT;</span></span><br><span class="line"><span class="addition">+		event.KeyInput.PressedDown = true;</span></span><br><span class="line"><span class="addition">+		dev = getDeviceFromHWnd(hWnd);</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Char = wParam;</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Key = irr::KEY_ACCEPT;</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Shift = 0;</span></span><br><span class="line"><span class="addition">+		event.KeyInput.Control = 0;</span></span><br><span class="line"><span class="addition">+		if (dev)</span></span><br><span class="line"><span class="addition">+			dev-&gt;postEventFromUser(event);</span></span><br><span class="line"><span class="addition">+		return 0;</span></span><br><span class="line"> 	&#125;</span><br><span class="line"><span class="deletion">-	return DefWindowProc(hWnd, message, wParam, lParam);</span></span><br><span class="line"><span class="addition">+	return DefWindowProcW(hWnd, message, wParam, lParam);</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -931,15 +961,15 @@</span></span><br><span class="line"> 	memset(&amp;DesktopMode, 0, sizeof(DesktopMode));</span><br><span class="line"> 	DesktopMode.dmSize = sizeof(DesktopMode);</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	EnumDisplaySettings(NULL, ENUM_CURRENT_SETTINGS, &amp;DesktopMode);</span></span><br><span class="line"><span class="addition">+	EnumDisplaySettingsW(NULL, ENUM_CURRENT_SETTINGS, &amp;DesktopMode);</span></span><br><span class="line"> </span><br><span class="line"> 	// create the window if we need to and we do not use the null device</span><br><span class="line"> 	if (!CreationParams.WindowId &amp;&amp; CreationParams.DriverType != video::EDT_NULL)</span><br><span class="line"> 	&#123;</span><br><span class="line"><span class="deletion">-		const fschar_t* ClassName = __TEXT("CIrrDeviceWin32");</span></span><br><span class="line"><span class="addition">+		const wchar_t* ClassName = L"CIrrDeviceWin32";</span></span><br><span class="line"> </span><br><span class="line"> 		// Register Class</span><br><span class="line"><span class="deletion">-		WNDCLASSEX wcex;</span></span><br><span class="line"><span class="addition">+		WNDCLASSEXW wcex;</span></span><br><span class="line"> 		wcex.cbSize			= sizeof(WNDCLASSEX);</span><br><span class="line"> 		wcex.style			= CS_HREDRAW | CS_VREDRAW;</span><br><span class="line"> 		wcex.lpfnWndProc	= WndProc;</span><br><span class="line"><span class="chunk">@@ -954,9 +984,9 @@</span></span><br><span class="line"> 		wcex.hIconSm		= 0;</span><br><span class="line"> </span><br><span class="line"> 		// if there is an icon, load it</span><br><span class="line"><span class="deletion">-		wcex.hIcon = (HICON)LoadImage(hInstance, __TEXT("irrlicht.ico"), IMAGE_ICON, 0,0, LR_LOADFROMFILE);</span></span><br><span class="line"><span class="addition">+		wcex.hIcon = (HICON)LoadImageW(hInstance, L"irrlicht.ico", IMAGE_ICON, 0,0, LR_LOADFROMFILE);</span></span><br><span class="line"> </span><br><span class="line"><span class="deletion">-		RegisterClassEx(&amp;wcex);</span></span><br><span class="line"><span class="addition">+		RegisterClassExW(&amp;wcex);</span></span><br><span class="line"> </span><br><span class="line"> 		// calculate client size</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -992,7 +1022,7 @@</span></span><br><span class="line"> </span><br><span class="line"> 		// create window</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-		HWnd = CreateWindow( ClassName, __TEXT(""), style, windowLeft, windowTop,</span></span><br><span class="line"><span class="addition">+		HWnd = CreateWindowW( ClassName, L"", style, windowLeft, windowTop,</span></span><br><span class="line"> 					realWidth, realHeight, NULL, NULL, hInstance, NULL);</span><br><span class="line"> 		CreationParams.WindowId = HWnd;</span><br><span class="line"> //		CreationParams.WindowSize.Width = realWidth;</span><br><span class="line"><span class="chunk">@@ -1297,15 +1327,15 @@</span></span><br><span class="line"> void CIrrDeviceWin32::closeDevice()</span><br><span class="line"> &#123;</span><br><span class="line"> 	MSG msg;</span><br><span class="line"><span class="deletion">-	PeekMessage(&amp;msg, NULL, WM_QUIT, WM_QUIT, PM_REMOVE);</span></span><br><span class="line"><span class="addition">+	PeekMessageW(&amp;msg, NULL, WM_QUIT, WM_QUIT, PM_REMOVE);</span></span><br><span class="line"> 	PostQuitMessage(0);</span><br><span class="line"><span class="deletion">-	PeekMessage(&amp;msg, NULL, WM_QUIT, WM_QUIT, PM_REMOVE);</span></span><br><span class="line"><span class="addition">+	PeekMessageW(&amp;msg, NULL, WM_QUIT, WM_QUIT, PM_REMOVE);</span></span><br><span class="line"> 	if (!ExternalWindow)</span><br><span class="line"> 	&#123;</span><br><span class="line"> 		DestroyWindow(HWnd);</span><br><span class="line"><span class="deletion">-		const fschar_t* ClassName = __TEXT("CIrrDeviceWin32");</span></span><br><span class="line"><span class="addition">+		const wchar_t* ClassName = L"CIrrDeviceWin32";</span></span><br><span class="line"> 		HINSTANCE hInstance = GetModuleHandle(0);</span><br><span class="line"><span class="deletion">-		UnregisterClass(ClassName, hInstance);</span></span><br><span class="line"><span class="addition">+		UnregisterClassW(ClassName, hInstance);</span></span><br><span class="line"> 	&#125;</span><br><span class="line"> 	Close=true;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="chunk">@@ -1351,7 +1381,7 @@</span></span><br><span class="line"> 	&#123;</span><br><span class="line"> 		if (ChangedToFullScreen)</span><br><span class="line"> 		&#123;</span><br><span class="line"><span class="deletion">-			return (ChangeDisplaySettings(&amp;DesktopMode,0)==DISP_CHANGE_SUCCESSFUL);</span></span><br><span class="line"><span class="addition">+			return (ChangeDisplaySettingsW(&amp;DesktopMode,0)==DISP_CHANGE_SUCCESSFUL);</span></span><br><span class="line"> 		&#125;</span><br><span class="line"> 		else</span><br><span class="line"> 			return true;</span><br><span class="line"><span class="chunk">@@ -1478,18 +1508,18 @@</span></span><br><span class="line"> </span><br><span class="line"> void CIrrDeviceWin32::getWindowsVersion(core::stringc&amp; out)</span><br><span class="line"> &#123;</span><br><span class="line"><span class="deletion">-	OSVERSIONINFOEX osvi;</span></span><br><span class="line"><span class="addition">+	OSVERSIONINFOEXW osvi;</span></span><br><span class="line"> 	PGPI pGPI;</span><br><span class="line"> 	BOOL bOsVersionInfoEx;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	ZeroMemory(&amp;osvi, sizeof(OSVERSIONINFOEX));</span></span><br><span class="line"><span class="deletion">-	osvi.dwOSVersionInfoSize = sizeof(OSVERSIONINFOEX);</span></span><br><span class="line"><span class="addition">+	ZeroMemory(&amp;osvi, sizeof(OSVERSIONINFOEXW));</span></span><br><span class="line"><span class="addition">+	osvi.dwOSVersionInfoSize = sizeof(OSVERSIONINFOEXW);</span></span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	bOsVersionInfoEx = GetVersionEx((OSVERSIONINFO*) &amp;osvi);</span></span><br><span class="line"><span class="addition">+	bOsVersionInfoEx = GetVersionExW((OSVERSIONINFOW*) &amp;osvi);</span></span><br><span class="line"> 	if (!bOsVersionInfoEx)</span><br><span class="line"> 	&#123;</span><br><span class="line"><span class="deletion">-		osvi.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);</span></span><br><span class="line"><span class="deletion">-		if (! GetVersionEx((OSVERSIONINFO *) &amp;osvi))</span></span><br><span class="line"><span class="addition">+		osvi.dwOSVersionInfoSize = sizeof(OSVERSIONINFOW);</span></span><br><span class="line"><span class="addition">+		if (! GetVersionExW((OSVERSIONINFOW *) &amp;osvi))</span></span><br><span class="line"> 			return;</span><br><span class="line"> 	&#125;</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -1528,7 +1558,7 @@</span></span><br><span class="line"> 			if (osvi.dwMajorVersion == 6)</span><br><span class="line"> 			&#123;</span><br><span class="line"> 				DWORD dwType;</span><br><span class="line"><span class="deletion">-				pGPI = (PGPI)GetProcAddress(GetModuleHandle(TEXT("kernel32.dll")), "GetProductInfo");</span></span><br><span class="line"><span class="addition">+				pGPI = (PGPI)GetProcAddress(GetModuleHandleW(L"kernel32.dll"), "GetProductInfo");</span></span><br><span class="line"> 				pGPI(osvi.dwMajorVersion, osvi.dwMinorVersion, 0, 0, &amp;dwType);</span><br><span class="line"> </span><br><span class="line"> 				switch (dwType)</span><br><span class="line"><span class="chunk">@@ -1594,21 +1624,21 @@</span></span><br><span class="line"> 		else</span><br><span class="line"> 		&#123;</span><br><span class="line"> 			HKEY hKey;</span><br><span class="line"><span class="deletion">-			char szProductType[80];</span></span><br><span class="line"><span class="addition">+			wchar_t szProductType[80];</span></span><br><span class="line"> 			DWORD dwBufLen;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-			RegOpenKeyEx( HKEY_LOCAL_MACHINE,</span></span><br><span class="line"><span class="deletion">-					__TEXT("SYSTEM\\CurrentControlSet\\Control\\ProductOptions"),</span></span><br><span class="line"><span class="addition">+			RegOpenKeyExW( HKEY_LOCAL_MACHINE,</span></span><br><span class="line"><span class="addition">+					L"SYSTEM\\CurrentControlSet\\Control\\ProductOptions",</span></span><br><span class="line"> 					0, KEY_QUERY_VALUE, &amp;hKey );</span><br><span class="line"><span class="deletion">-			RegQueryValueEx( hKey, __TEXT("ProductType"), NULL, NULL,</span></span><br><span class="line"><span class="addition">+			RegQueryValueExW( hKey, L"ProductType", NULL, NULL,</span></span><br><span class="line"> 					(LPBYTE) szProductType, &amp;dwBufLen);</span><br><span class="line"> 			RegCloseKey( hKey );</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-			if (_strcmpi( "WINNT", szProductType) == 0 )</span></span><br><span class="line"><span class="addition">+			if (lstrcmpiW( L"WINNT", szProductType) == 0 )</span></span><br><span class="line"> 				out.append("Professional ");</span><br><span class="line"><span class="deletion">-			if (_strcmpi( "LANMANNT", szProductType) == 0)</span></span><br><span class="line"><span class="addition">+			if (lstrcmpiW( L"LANMANNT", szProductType) == 0)</span></span><br><span class="line"> 				out.append("Server ");</span><br><span class="line"><span class="deletion">-			if (_strcmpi( "SERVERNT", szProductType) == 0)</span></span><br><span class="line"><span class="addition">+			if (lstrcmpiW( L"SERVERNT", szProductType) == 0)</span></span><br><span class="line"> 				out.append("Advanced Server ");</span><br><span class="line"> 		&#125;</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -1679,7 +1709,7 @@</span></span><br><span class="line"> 	else</span><br><span class="line"> 		style = WS_THICKFRAME | WS_SYSMENU | WS_CAPTION | WS_CLIPCHILDREN | WS_CLIPSIBLINGS | WS_MINIMIZEBOX | WS_MAXIMIZEBOX;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	if (!SetWindowLongPtr(HWnd, GWL_STYLE, style))</span></span><br><span class="line"><span class="addition">+	if (!SetWindowLongPtrW(HWnd, GWL_STYLE, style))</span></span><br><span class="line"> 		os::Printer::log("Could not change window style.");</span><br><span class="line"> </span><br><span class="line"> 	RECT clientSize;</span><br><span class="line"><span class="chunk">@@ -1791,15 +1821,15 @@</span></span><br><span class="line"> &#123;</span><br><span class="line"> 	MSG msg;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	while (PeekMessage(&amp;msg, NULL, 0, 0, PM_REMOVE))</span></span><br><span class="line"><span class="addition">+	while (PeekMessageW(&amp;msg, NULL, 0, 0, PM_REMOVE))</span></span><br><span class="line"> 	&#123;</span><br><span class="line"> 		// No message translation because we don't use WM_CHAR and it would conflict with our</span><br><span class="line"> 		// deadkey handling.</span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+		TranslateMessage(&amp;msg);</span></span><br><span class="line"> 		if (ExternalWindow &amp;&amp; msg.hwnd == HWnd)</span><br><span class="line"> 			WndProc(HWnd, msg.message, msg.wParam, msg.lParam);</span><br><span class="line"> 		else</span><br><span class="line"><span class="deletion">-			DispatchMessage(&amp;msg);</span></span><br><span class="line"><span class="addition">+			DispatchMessageW(&amp;msg);</span></span><br><span class="line"> </span><br><span class="line"> 		if (msg.message == WM_QUIT)</span><br><span class="line"> 			Close = true;</span><br><span class="line"><span class="chunk">@@ -1811,9 +1841,9 @@</span></span><br><span class="line"> void CIrrDeviceWin32::clearSystemMessages()</span><br><span class="line"> &#123;</span><br><span class="line"> 	MSG msg;</span><br><span class="line"><span class="deletion">-	while (PeekMessage(&amp;msg, NULL, WM_KEYFIRST, WM_KEYLAST, PM_REMOVE))</span></span><br><span class="line"><span class="addition">+	while (PeekMessageW(&amp;msg, NULL, WM_KEYFIRST, WM_KEYLAST, PM_REMOVE))</span></span><br><span class="line"> 	&#123;&#125;</span><br><span class="line"><span class="deletion">-	while (PeekMessage(&amp;msg, NULL, WM_MOUSEFIRST, WM_MOUSELAST, PM_REMOVE))</span></span><br><span class="line"><span class="addition">+	while (PeekMessageW(&amp;msg, NULL, WM_MOUSEFIRST, WM_MOUSELAST, PM_REMOVE))</span></span><br><span class="line"> 	&#123;&#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -1821,12 +1851,12 @@</span></span><br><span class="line"> void CIrrDeviceWin32::ReportLastWinApiError()</span><br><span class="line"> &#123;</span><br><span class="line"> 	// (based on code from ovidiucucu from http://www.codeguru.com/forum/showthread.php?t=318721)</span><br><span class="line"><span class="deletion">-	LPCTSTR pszCaption = __TEXT("Windows SDK Error Report");</span></span><br><span class="line"><span class="addition">+	LPCWSTR pszCaption = L"Windows SDK Error Report";</span></span><br><span class="line"> 	DWORD dwError = GetLastError();</span><br><span class="line"> </span><br><span class="line"> 	if(NOERROR == dwError)</span><br><span class="line"> 	&#123;</span><br><span class="line"><span class="deletion">-		MessageBox(NULL, __TEXT("No error"), pszCaption, MB_OK);</span></span><br><span class="line"><span class="addition">+		MessageBoxW(NULL, L"No error", pszCaption, MB_OK);</span></span><br><span class="line"> 	&#125;</span><br><span class="line"> 	else</span><br><span class="line"> 	&#123;</span><br><span class="line"><span class="chunk">@@ -1835,21 +1865,21 @@</span></span><br><span class="line"> 										FORMAT_MESSAGE_FROM_SYSTEM;</span><br><span class="line"> </span><br><span class="line"> 		LPVOID pTextBuffer = NULL;</span><br><span class="line"><span class="deletion">-		DWORD dwCount = FormatMessage(dwFormatControl,</span></span><br><span class="line"><span class="addition">+		DWORD dwCount = FormatMessageW(dwFormatControl,</span></span><br><span class="line"> 										NULL,</span><br><span class="line"> 										dwError,</span><br><span class="line"> 										0,</span><br><span class="line"><span class="deletion">-										(LPTSTR) &amp;pTextBuffer,</span></span><br><span class="line"><span class="addition">+										(LPWSTR)&amp;pTextBuffer,</span></span><br><span class="line"> 										0,</span><br><span class="line"> 										NULL);</span><br><span class="line"> 		if(0 != dwCount)</span><br><span class="line"> 		&#123;</span><br><span class="line"><span class="deletion">-			MessageBox(NULL, (LPCTSTR)pTextBuffer, pszCaption, MB_OK|MB_ICONERROR);</span></span><br><span class="line"><span class="addition">+			MessageBoxW(NULL, (LPCWSTR)pTextBuffer, pszCaption, MB_OK|MB_ICONERROR);</span></span><br><span class="line"> 			LocalFree(pTextBuffer);</span><br><span class="line"> 		&#125;</span><br><span class="line"> 		else</span><br><span class="line"> 		&#123;</span><br><span class="line"><span class="deletion">-			MessageBox(NULL, __TEXT("Unknown error"), pszCaption, MB_OK|MB_ICONERROR);</span></span><br><span class="line"><span class="addition">+			MessageBoxW(NULL, L"Unknown error", pszCaption, MB_OK|MB_ICONERROR);</span></span><br><span class="line"> 		&#125;</span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/CIrrDeviceWin32.h irrlicht-fixed/src/CIrrDeviceWin32.h</span><br><span class="line"><span class="header">--- irrlicht/src/CIrrDeviceWin32.h	2012-11-05 07:14:12.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/CIrrDeviceWin32.h	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -395,7 +395,7 @@</span></span><br><span class="line"> 		bool Resized;</span><br><span class="line"> 		bool ExternalWindow;</span><br><span class="line"> 		CCursorControl* Win32CursorControl;</span><br><span class="line"><span class="deletion">-		DEVMODE DesktopMode;</span></span><br><span class="line"><span class="addition">+		DEVMODEW DesktopMode;</span></span><br><span class="line"> </span><br><span class="line"> 		SJoystickWin32Control* JoyControl;</span><br><span class="line"> 	&#125;;</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/COpenGLDriver.cpp irrlicht-fixed/src/COpenGLDriver.cpp</span><br><span class="line"><span class="header">--- irrlicht/src/COpenGLDriver.cpp	2012-11-03 10:08:08.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/COpenGLDriver.cpp	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -85,11 +85,11 @@</span></span><br><span class="line"> bool COpenGLDriver::initDriver(CIrrDeviceWin32* device)</span><br><span class="line"> &#123;</span><br><span class="line"> 	// Create a window to test antialiasing support</span><br><span class="line"><span class="deletion">-	const fschar_t* ClassName = __TEXT("GLCIrrDeviceWin32");</span></span><br><span class="line"><span class="addition">+	const wchar_t* ClassName = L"GLCIrrDeviceWin32";</span></span><br><span class="line"> 	HINSTANCE lhInstance = GetModuleHandle(0);</span><br><span class="line"> </span><br><span class="line"> 	// Register Class</span><br><span class="line"><span class="deletion">-	WNDCLASSEX wcex;</span></span><br><span class="line"><span class="addition">+	WNDCLASSEXW wcex;</span></span><br><span class="line"> 	wcex.cbSize        = sizeof(WNDCLASSEX);</span><br><span class="line"> 	wcex.style         = CS_HREDRAW | CS_VREDRAW;</span><br><span class="line"> 	wcex.lpfnWndProc   = (WNDPROC)DefWindowProc;</span><br><span class="line"><span class="chunk">@@ -103,7 +103,7 @@</span></span><br><span class="line"> 	wcex.lpszClassName = ClassName;</span><br><span class="line"> 	wcex.hIconSm       = 0;</span><br><span class="line"> 	wcex.hIcon         = 0;</span><br><span class="line"><span class="deletion">-	RegisterClassEx(&amp;wcex);</span></span><br><span class="line"><span class="addition">+	RegisterClassExW(&amp;wcex);</span></span><br><span class="line"> </span><br><span class="line"> 	RECT clientSize;</span><br><span class="line"> 	clientSize.top = 0;</span><br><span class="line"><span class="chunk">@@ -123,13 +123,13 @@</span></span><br><span class="line"> 	const s32 windowLeft = (GetSystemMetrics(SM_CXSCREEN) - realWidth) / 2;</span><br><span class="line"> 	const s32 windowTop = (GetSystemMetrics(SM_CYSCREEN) - realHeight) / 2;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	HWND temporary_wnd=CreateWindow(ClassName, __TEXT(""), style, windowLeft,</span></span><br><span class="line"><span class="addition">+	HWND temporary_wnd=CreateWindowW(ClassName, L"", style, windowLeft,</span></span><br><span class="line"> 			windowTop, realWidth, realHeight, NULL, NULL, lhInstance, NULL);</span><br><span class="line"> </span><br><span class="line"> 	if (!temporary_wnd)</span><br><span class="line"> 	&#123;</span><br><span class="line"> 		os::Printer::log("Cannot create a temporary window.", ELL_ERROR);</span><br><span class="line"><span class="deletion">-		UnregisterClass(ClassName, lhInstance);</span></span><br><span class="line"><span class="addition">+		UnregisterClassW(ClassName, lhInstance);</span></span><br><span class="line"> 		return false;</span><br><span class="line"> 	&#125;</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -201,7 +201,7 @@</span></span><br><span class="line"> 			os::Printer::log("Cannot create a GL device context", "No suitable format for temporary window.", ELL_ERROR);</span><br><span class="line"> 			ReleaseDC(temporary_wnd, HDc);</span><br><span class="line"> 			DestroyWindow(temporary_wnd);</span><br><span class="line"><span class="deletion">-			UnregisterClass(ClassName, lhInstance);</span></span><br><span class="line"><span class="addition">+			UnregisterClassW(ClassName, lhInstance);</span></span><br><span class="line"> 			return false;</span><br><span class="line"> 		&#125;</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -218,7 +218,7 @@</span></span><br><span class="line"> 		os::Printer::log("Cannot create a temporary GL rendering context.", ELL_ERROR);</span><br><span class="line"> 		ReleaseDC(temporary_wnd, HDc);</span><br><span class="line"> 		DestroyWindow(temporary_wnd);</span><br><span class="line"><span class="deletion">-		UnregisterClass(ClassName, lhInstance);</span></span><br><span class="line"><span class="addition">+		UnregisterClassW(ClassName, lhInstance);</span></span><br><span class="line"> 		return false;</span><br><span class="line"> 	&#125;</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -234,7 +234,7 @@</span></span><br><span class="line"> 		wglDeleteContext(hrc);</span><br><span class="line"> 		ReleaseDC(temporary_wnd, HDc);</span><br><span class="line"> 		DestroyWindow(temporary_wnd);</span><br><span class="line"><span class="deletion">-		UnregisterClass(ClassName, lhInstance);</span></span><br><span class="line"><span class="addition">+		UnregisterClassW(ClassName, lhInstance);</span></span><br><span class="line"> 		return false;</span><br><span class="line"> 	&#125;</span><br><span class="line"> </span><br><span class="line"><span class="chunk">@@ -340,7 +340,7 @@</span></span><br><span class="line"> 	wglDeleteContext(hrc);</span><br><span class="line"> 	ReleaseDC(temporary_wnd, HDc);</span><br><span class="line"> 	DestroyWindow(temporary_wnd);</span><br><span class="line"><span class="deletion">-	UnregisterClass(ClassName, lhInstance);</span></span><br><span class="line"><span class="addition">+	UnregisterClassW(ClassName, lhInstance);</span></span><br><span class="line"> </span><br><span class="line"> 	// get hdc</span><br><span class="line"> 	HDc=GetDC(Window);</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/COSOperator.cpp irrlicht-fixed/src/COSOperator.cpp</span><br><span class="line"><span class="header">--- irrlicht/src/COSOperator.cpp	2012-11-03 10:07:52.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/COSOperator.cpp	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -52,11 +52,8 @@</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> //! copies text to the clipboard</span><br><span class="line"><span class="deletion">-void COSOperator::copyToClipboard(const c8* text) const</span></span><br><span class="line"><span class="addition">+void COSOperator::copyToClipboard(const c16* text) const</span></span><br><span class="line"> &#123;</span><br><span class="line"><span class="deletion">-	if (strlen(text)==0)</span></span><br><span class="line"><span class="deletion">-		return;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"> // Windows version</span><br><span class="line"> #if defined(_IRR_XBOX_PLATFORM_)</span><br><span class="line"> #elif defined(_IRR_WINDOWS_API_)</span><br><span class="line"><span class="chunk">@@ -66,6 +63,19 @@</span></span><br><span class="line"> 	EmptyClipboard();</span><br><span class="line"> </span><br><span class="line"> 	HGLOBAL clipbuffer;</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+#if defined(_UNICODE)</span></span><br><span class="line"><span class="addition">+	wchar_t * utext = (wchar_t *)text;</span></span><br><span class="line"><span class="addition">+	wchar_t * buffer;</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+	clipbuffer = GlobalAlloc(GMEM_DDESHARE, sizeof(wchar_t) * (wcslen(utext)+1));</span></span><br><span class="line"><span class="addition">+	buffer = (wchar_t*)GlobalLock(clipbuffer);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+	wcscpy(buffer, utext);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+	GlobalUnlock(clipbuffer);</span></span><br><span class="line"><span class="addition">+	SetClipboardData(CF_UNICODETEXT, clipbuffer);</span></span><br><span class="line"><span class="addition">+#else</span></span><br><span class="line"> 	char * buffer;</span><br><span class="line"> </span><br><span class="line"> 	clipbuffer = GlobalAlloc(GMEM_DDESHARE, strlen(text)+1);</span><br><span class="line"><span class="chunk">@@ -75,6 +85,8 @@</span></span><br><span class="line"> </span><br><span class="line"> 	GlobalUnlock(clipbuffer);</span><br><span class="line"> 	SetClipboardData(CF_TEXT, clipbuffer);</span><br><span class="line"><span class="addition">+#endif</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"> 	CloseClipboard();</span><br><span class="line"> </span><br><span class="line"> // MacOSX version</span><br><span class="line"><span class="chunk">@@ -93,7 +105,7 @@</span></span><br><span class="line"> </span><br><span class="line"> //! gets text from the clipboard</span><br><span class="line"> //! \return Returns 0 if no string is in there.</span><br><span class="line"><span class="deletion">-const c8* COSOperator::getTextFromClipboard() const</span></span><br><span class="line"><span class="addition">+const c16* COSOperator::getTextFromClipboard() const</span></span><br><span class="line"> &#123;</span><br><span class="line"> #if defined(_IRR_XBOX_PLATFORM_)</span><br><span class="line"> 		return 0;</span><br><span class="line"><span class="chunk">@@ -101,10 +113,14 @@</span></span><br><span class="line"> 	if (!OpenClipboard(NULL))</span><br><span class="line"> 		return 0;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-	char * buffer = 0;</span></span><br><span class="line"><span class="addition">+	wchar_t * buffer = 0;</span></span><br><span class="line"> </span><br><span class="line"><span class="addition">+#ifdef _UNICODE</span></span><br><span class="line"><span class="addition">+	HANDLE hData = GetClipboardData( CF_UNICODETEXT );</span></span><br><span class="line"><span class="addition">+#else</span></span><br><span class="line"> 	HANDLE hData = GetClipboardData( CF_TEXT );</span><br><span class="line"><span class="deletion">-	buffer = (char*)GlobalLock( hData );</span></span><br><span class="line"><span class="addition">+#endif</span></span><br><span class="line"><span class="addition">+	buffer = (wchar_t*)GlobalLock( hData );</span></span><br><span class="line"> 	GlobalUnlock( hData );</span><br><span class="line"> 	CloseClipboard();</span><br><span class="line"> 	return buffer;</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/COSOperator.h irrlicht-fixed/src/COSOperator.h</span><br><span class="line"><span class="header">--- irrlicht/src/COSOperator.h	2012-11-03 10:08:00.000000000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/COSOperator.h	2015-06-14 17:32:58.000000000 +0000</span></span><br><span class="line"><span class="chunk">@@ -27,11 +27,11 @@</span></span><br><span class="line"> 	virtual const core::stringc&amp; getOperatingSystemVersion() const;</span><br><span class="line"> </span><br><span class="line"> 	//! copies text to the clipboard</span><br><span class="line"><span class="deletion">-	virtual void copyToClipboard(const c8* text) const;</span></span><br><span class="line"><span class="addition">+	virtual void copyToClipboard(const c16* text) const;</span></span><br><span class="line"> </span><br><span class="line"> 	//! gets text from the clipboard</span><br><span class="line"> 	//! \return Returns 0 if no string is in there.</span><br><span class="line"><span class="deletion">-	virtual const c8* getTextFromClipboard() const;</span></span><br><span class="line"><span class="addition">+	virtual const c16* getTextFromClipboard() const;</span></span><br><span class="line"> </span><br><span class="line"> 	//! gets the processor speed in megahertz</span><br><span class="line"> 	//! \param Mhz:</span><br><span class="line">diff -ur --strip-trailing-cr irrlicht/src/CGUIEditBox.cpp irrlicht-fixed/src/CGUIEditBox.cpp</span><br><span class="line"><span class="header">--- irrlicht/src/CGUIEditBox.cpp	2016-09-15 18:12:49.532839000 +0000</span></span><br><span class="line"><span class="header">+++ irrlicht-fixed/src/CGUIEditBox.cpp	2016-09-15 18:13:37.101559800 +0000</span></span><br><span class="line"><span class="chunk">@@ -333,13 +333,7 @@</span></span><br><span class="line"> 				const c16* p = Operator-&gt;getTextFromClipboard();</span><br><span class="line"> 				if (p)</span><br><span class="line"> 				&#123;</span><br><span class="line"><span class="deletion">-					// TODO: we should have such a function in core::string</span></span><br><span class="line"><span class="deletion">-					size_t lenOld = strlen(p);</span></span><br><span class="line"><span class="deletion">-					wchar_t *ws = new wchar_t[lenOld + 1];</span></span><br><span class="line"><span class="deletion">-					size_t len = mbstowcs(ws,p,lenOld);</span></span><br><span class="line"><span class="deletion">-					ws[len] = 0;</span></span><br><span class="line"><span class="deletion">-					irr::core::stringw widep(ws);</span></span><br><span class="line"><span class="deletion">-					delete[] ws;</span></span><br><span class="line"><span class="addition">+					irr::core::stringw widep(p);</span></span><br><span class="line"> </span><br><span class="line"> 					if (MarkBegin == MarkEnd)</span><br><span class="line"> 					&#123;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">patch -p1 &lt; irrlicht.patch</span><br></pre></td></tr></table></figure>
<p>根据 irrlicht 的 vcxproj，得到如下 <a href="irrlicht/premake4.lua"><code>premake4.lua</code></a>，放到 <code>irrlicht</code> 文件夹里。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"Irrlicht"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    includedirs &#123; <span class="string">"include"</span>, <span class="string">"src"</span>, <span class="string">"src/jpeglib"</span>, <span class="string">"src/libpng"</span>, <span class="string">"src/zlib"</span> &#125;</span><br><span class="line">    </span><br><span class="line">    defines &#123; <span class="string">"_IRR_STATIC_LIB_"</span> &#125;</span><br><span class="line">    flags &#123; <span class="string">"NoExceptions"</span>, <span class="string">"NoRTTI"</span> &#125;</span><br><span class="line">    </span><br><span class="line">    files &#123; <span class="string">"src/CCgMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9CgMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDefaultSceneNodeAnimatorFactory.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDefaultSceneNodeFactory.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGeometryCreator.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMeshCache.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMeshManipulator.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLCgMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneManager.cpp"</span>,</span><br><span class="line">            <span class="string">"src/C3DSMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSMFMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshHalfLife.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshMD2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshMD3.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CB3DMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBSPMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CColladaFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CCSMLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDMFLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLMTSMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLWOMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMD2MeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMD3MeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMS3DMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMY3DMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COBJMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COCTLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COgreMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CPLYMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CQ3LevelMesh.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSkinnedMesh.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSTLMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CXMeshFileLoader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAnimatedMeshSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBillboardSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBoneSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CCameraSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CCubeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDummyTransformationSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CEmptySceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLightSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMeshSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COctreeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CQuake3ShaderSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CShadowVolumeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSkyBoxSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSkyDomeSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSphereSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTerrainSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTextSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CVolumeLightSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CWaterSurfaceSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleAnimatedMeshSceneNodeEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleAttractionAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleBoxEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleCylinderEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleFadeOutAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleGravityAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleMeshEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticlePointEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleRingEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleRotationAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleScaleAffector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleSphereEmitter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CParticleSystemSceneNode.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMetaTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COctreeTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneCollisionManager.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTerrainTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTriangleBBSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTriangleSelector.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneLoaderIrr.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorCameraFPS.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorCameraMaya.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorCollisionResponse.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorDelete.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorFlyCircle.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorFlyStraight.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorFollowSpline.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorRotation.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSceneNodeAnimatorTexture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CColladaMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COBJMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CPLYMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSTLMeshWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CVideoModeList.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareDriver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareTexture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRFlat.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRFlatWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraud.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraudWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureFlat.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureFlatWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraud.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAdd.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudNoZ.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudWire.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CZBuffer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLDriver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLExtensionHandler.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLNormalMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLParallaxMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLShaderMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLSLMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COpenGLTexture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8Driver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8NormalMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8ParallaxMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8ShaderMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D8Texture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CColorConverter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CFPSCounter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImage.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CNullDriver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterBMP.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterJPG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPCX.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPNG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPPM.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterPSD.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageWriterTGA.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderBMP.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderDDS.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderJPG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPCX.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPNG.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPPM.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderPSD.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderRGB.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderTGA.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CImageLoaderWAL.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9Driver.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9HLSLMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9NormalMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9ParallaxMapRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9ShaderMaterialRenderer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CD3D9Texture.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CBurningShader_Raster_Reference.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDepthBuffer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareDriver2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CSoftwareTexture2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraud2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraudAlpha2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRGouraudAlphaNoZ2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRNormalMap.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRStencilShadow.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureBlend.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureDetailMap2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraud2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAdd2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAddNoZ2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAlpha.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudAlphaNoZ.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudNoZ2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureGouraudVertexAlpha2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_Add.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_M1.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_M2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMap2_M4.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureLightMapGouraud2_M4.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTRTextureWire2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/IBurningShader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLogger.cpp"</span>,</span><br><span class="line">            <span class="string">"src/COSOperator.cpp"</span>,</span><br><span class="line">            <span class="string">"src/Irrlicht.cpp"</span>,</span><br><span class="line">            <span class="string">"src/os.cpp"</span>,</span><br><span class="line">            <span class="string">"src/lzma/LzmaDec.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/adler32.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/compress.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/crc32.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/deflate.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/inffast.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/inflate.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/inftrees.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/trees.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/uncompr.c"</span>,</span><br><span class="line">            <span class="string">"src/zlib/zutil.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jaricom.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcapimin.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcapistd.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcarith.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jccoefct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jccolor.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcdctmgr.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jchuff.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcinit.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcmainct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcmarker.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcmaster.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcomapi.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcparam.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcprepct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jcsample.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jctrans.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdapimin.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdapistd.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdarith.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdatadst.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdatasrc.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdcoefct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdcolor.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jddctmgr.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdhuff.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdinput.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmainct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmarker.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmaster.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdmerge.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdpostct.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdsample.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jdtrans.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jerror.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jfdctflt.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jfdctfst.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jfdctint.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jidctflt.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jidctfst.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jidctint.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jmemmgr.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jmemnobs.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jquant1.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jquant2.c"</span>,</span><br><span class="line">            <span class="string">"src/jpeglib/jutils.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/png.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngerror.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngget.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngmem.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngpread.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngread.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngrio.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngrtran.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngrutil.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngset.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngtrans.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwio.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwrite.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwtran.c"</span>,</span><br><span class="line">            <span class="string">"src/libpng/pngwutil.c"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/aescrypt.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/aeskey.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/aestab.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/fileenc.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/hmac.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/prng.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/pwd2key.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/sha1.cpp"</span>,</span><br><span class="line">            <span class="string">"src/aesGladman/sha2.cpp"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/blocksort.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/bzcompress.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/bzlib.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/crctable.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/decompress.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/huffman.c"</span>,</span><br><span class="line">            <span class="string">"src/bzip2/randtable.c"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceConsole.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceFB.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceLinux.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceSDL.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceStub.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceWin32.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CIrrDeviceWinCE.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CAttributes.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CFileList.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CFileSystem.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CLimitReadFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMemoryFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CMountPointReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CNPKReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CPakReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CReadFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CTarReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CWADReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CWriteFile.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CXMLReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CXMLWriter.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CZipReader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/irrXML.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CDefaultGUIElementFactory.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIButton.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUICheckbox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIColorSelectDialog.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIComboBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIContextMenu.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIEditBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIEnvironment.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIFileOpenDialog.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIFont.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIImage.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIImageList.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIInOutFader.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIListBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIMenu.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIMeshViewer.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIMessageBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIModalScreen.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIScrollBar.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUISkin.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUISpinBox.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUISpriteBank.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIStaticText.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUITabControl.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUITable.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIToolBar.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUITreeView.cpp"</span>,</span><br><span class="line">            <span class="string">"src/CGUIWindow.cpp"</span> &#125;</span><br><span class="line"></span><br><span class="line">    configuration &#123; <span class="string">"vs*"</span> &#125;</span><br><span class="line">        defines &#123; <span class="string">"IRRLICHT_FAST_MATH"</span>, <span class="string">"UNICODE"</span>, <span class="string">"_UNICODE"</span> &#125;</span><br><span class="line">            includedirs &#123; <span class="string">"$(DXSDK_DIR)include"</span> &#125;</span><br><span class="line">        libdirs &#123; <span class="string">"$(DXSDK_DIR)Lib/x86"</span> &#125;</span><br><span class="line"></span><br><span class="line">    configuration &#123; <span class="string">"windows"</span> &#125;</span><br><span class="line">        links &#123; <span class="string">"imm32"</span> &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="5-_配置_Lua">5. 配置 Lua</h1><p>解压 <a href="https://www.lua.org/ftp/lua-5.2.4.tar.gz" target="_blank" rel="external"><code>lua-5.2.4.tar.gz</code></a> 到项目目录，将文件夹重命名为 <code>lua</code>。<br>为兼容 YGOPRO 源码，将 <code>src</code> 文件夹里除 Makefile 外的文件全部移动到 <code>lua</code> 文件夹。<br>Lua 源码的文件结构非常简单，直接把如下 <a href="lua/premake4.lua"><code>premake4.lua</code></a> 放到 <code>lua</code> 文件夹里即可。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"lua"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    files &#123; <span class="string">"*.c"</span>, <span class="string">"*.h"</span> &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="6-_配置_SQLite">6. 配置 SQLite</h1><p>解压 <a href="https://www.sqlite.org/2016/sqlite-amalgamation-3140200.zip" target="_blank" rel="external"><code>sqlite-amalgamation-3140200.zip</code></a> 到项目目录，将文件夹重命名为 <code>sqlite3</code>。<br>SQLite 源码的文件结构非常简单，直接把如下 <a href="sqlite3/premake4.lua"><code>premake4.lua</code></a> 放到 <code>sqlite3</code> 文件夹里即可。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">project <span class="string">"sqlite3"</span></span><br><span class="line">    kind <span class="string">"StaticLib"</span></span><br><span class="line"></span><br><span class="line">    files &#123; <span class="string">"sqlite3.c"</span>, <span class="string">"sqlite3.h"</span> &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="7-_生成解决方案">7. 生成解决方案</h1><p>在生成解决方案之前，我们还需要对 premake 做几个设置。<br>打开项目目录中的 <a href="premake4.lua"><code>premake4.lua</code></a>，做如下修改。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">configuration <span class="string">"windows"</span></span><br><span class="line">    defines &#123; <span class="string">"WIN32"</span>, <span class="string">"_WIN32"</span>, <span class="string">"WINVER=0x0501"</span> &#125;</span><br></pre></td></tr></table></figure></p>
<p>然后添加如下内容。<br><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">configuration &#123; <span class="string">"Release"</span>, <span class="string">"vs*"</span> &#125;</span><br><span class="line">    flags &#123; <span class="string">"StaticRuntime"</span>, <span class="string">"LinkTimeOptimization"</span> &#125;</span><br><span class="line"></span><br><span class="line">startproject <span class="string">"ygopro"</span></span><br></pre></td></tr></table></figure></p>
<p>解压 <a href="https://github.com/premake/premake-core/releases/download/v5.0.0-alpha9/premake-5.0.0-alpha9-windows.zip" target="_blank" rel="external"><code>premake-5.0.0-alpha9-windows.zip</code></a> 到项目目录。<br>运行 <code>premake5 vs2015</code> 即可在 <code>build</code> 文件夹内生成sln文件。<br>程序还需要一个资源文件，把如下 <a href="gframe/ygopro.rc"><code>ygopro.rc</code></a> 和 <a href="gframe/ygopro.ico"><code>ygopro.ico</code></a> 放到 <code>gframe</code> 文件夹里。<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1 ICON "ygopro.ico"</span><br><span class="line"></span><br><span class="line">1 VERSIONINFO</span><br><span class="line">FILEVERSION 1, 0, 33, 11</span><br><span class="line">PRODUCTVERSION 1, 0, 33, 11</span><br><span class="line">FILEOS 0x4</span><br><span class="line">FILETYPE 0x1</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">BLOCK</span> <span class="string">"StringFileInfo"</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">BLOCK</span> <span class="string">"080404b0"</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"FileDescription"</span>, <span class="string">"YGOPRO"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"InternalName"</span>, <span class="string">"YGOPRO"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"LegalCopyright"</span>, <span class="string">"Copyright (C) 2016 Fluorohydride"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"OriginalFilename"</span>, <span class="string">"ygopro.exe"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"ProductName"</span>, <span class="string">"YGOPRO"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"FileVersion"</span>, <span class="string">"1.033.B.233"</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"ProductVersion"</span>, <span class="string">"1.033.B.233"</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">BLOCK</span> <span class="string">"VarFileInfo"</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">VALUE</span> <span class="string">"Translation"</span>, <span class="number">0x804</span>, <span class="number">1200</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">END</span></span></span><br></pre></td></tr></table></figure></p>
<h1 id="8-_选项设置">8. 选项设置</h1><p>完成了以上步骤后，我们的 ygo 项目已经可以用 VS2015 打开并编译了。<br>如需要程序支持XP，在 <code>ygopro</code> 的属性中将 <code>平台工具集</code> 设置为 <code>Visual Studio 2015 - Windows XP (v140_xp)</code>。<br>别忘记把 <code>解决方案配置</code> 改成 <code>Release</code>。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/经验/">经验</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://mercury233.me/2016/09/22/笔记：在Windows下编译YGOPRO/" data-title="笔记：在Windows下编译YGOPRO | Mercury233" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2016/03/13/网页中相对路径的一个坑/"  title="网页中相对路径的一个坑">
 <strong>下一篇：</strong><br/> 
 <span>网页中相对路径的一个坑
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div id="uyan_frame"></div>
	<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2088351"></script>
</section>




</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/技巧/" title="技巧">技巧<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/百度空间存档/" title="百度空间存档">百度空间存档<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/游戏王/" title="游戏王">游戏王<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/原创软件/" title="原创软件">原创软件<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/原创Web-App/" title="原创Web App">原创Web App<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/经验/" title="经验">经验<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/游戏/" title="游戏">游戏<sup>1</sup></a></li>
			
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">八月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">三月 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">十一月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">十二月 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/10/">十月 2008</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/05/">五月 2008</a><span class="archive-list-count">1</span></li></ul>
  </div>


  
  <div class="archiveslist">
    <p class="asidetitle">最新文章</p>
      <ul class="archive-list">
        
          <li class="archive-list-item">
            <a class="archive-list-link" href="/2016/09/22/笔记：在Windows下编译YGOPRO/">笔记：在Windows下编译YGOPRO</a>
          </li>
        
          <li class="archive-list-item">
            <a class="archive-list-link" href="/2016/03/13/网页中相对路径的一个坑/">网页中相对路径的一个坑</a>
          </li>
        
          <li class="archive-list-item">
            <a class="archive-list-link" href="/2015/10/14/卡池生成器/">卡池生成器</a>
          </li>
        
          <li class="archive-list-item">
            <a class="archive-list-link" href="/2015/09/17/hello-world/">Hello World</a>
          </li>
        
          <li class="archive-list-item">
            <a class="archive-list-link" href="/2015/08/12/网页版三国杀传奇数据表/">网页版三国杀传奇数据表</a>
          </li>
        
      </ul>
  </div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io/zh-cn/" target="_blank" title="hexo">hexo</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
            <img src="/img/cc-by-nc-sa.svg" alt="Creative Commons" />
          </a>
        </div>
    

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Mercury233">Mercury233</a>
		
		
		</p>
</div>
</footer>
    <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>













<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1255875151'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s23.cnzz.com/z_stat.php%3Fid%3D1255875151' type='text/javascript'%3E%3C/script%3E"));</script>





  </body>
</html>
